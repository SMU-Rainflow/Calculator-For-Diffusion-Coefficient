# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'END.ui'
#
# Created by: PyQt5 UI code generator 5.11.3
#
# WARNING! All changes made in this file will be lost!

from PyQt5 import QtCore, QtGui, QtWidgets

class Ui_MainWindow(object):
    """
    设置控件布局
    """
    def setupUi(self, MainWindow):
        MainWindow.setObjectName("MainWindow")
        MainWindow.resize(801, 600)
        self.centralwidget = QtWidgets.QWidget(MainWindow)
        self.centralwidget.setObjectName("centralwidget")
        self.label = QtWidgets.QLabel(self.centralwidget)
        self.label.setGeometry(QtCore.QRect(10, 130, 91, 31))
        self.label.setObjectName("label")
        self.label_2 = QtWidgets.QLabel(self.centralwidget)
        self.label_2.setGeometry(QtCore.QRect(10, 170, 101, 31))
        self.label_2.setObjectName("label_2")
        self.label_3 = QtWidgets.QLabel(self.centralwidget)
        self.label_3.setGeometry(QtCore.QRect(10, 210, 91, 31))
        self.label_3.setObjectName("label_3")
        self.label_4 = QtWidgets.QLabel(self.centralwidget)
        self.label_4.setGeometry(QtCore.QRect(10, 250, 81, 31))
        self.label_4.setObjectName("label_4")
        self.label_5 = QtWidgets.QLabel(self.centralwidget)
        self.label_5.setGeometry(QtCore.QRect(10, 290, 81, 31))
        self.label_5.setObjectName("label_5")
        self.label_6 = QtWidgets.QLabel(self.centralwidget)
        self.label_6.setGeometry(QtCore.QRect(240, 210, 91, 31))
        self.label_6.setObjectName("label_6")
        self.label_7 = QtWidgets.QLabel(self.centralwidget)
        self.label_7.setGeometry(QtCore.QRect(240, 250, 81, 31))
        self.label_7.setObjectName("label_7")
        self.label_8 = QtWidgets.QLabel(self.centralwidget)
        self.label_8.setGeometry(QtCore.QRect(240, 290, 81, 31))
        self.label_8.setObjectName("label_8")
        self.label_10 = QtWidgets.QLabel(self.centralwidget)
        self.label_10.setGeometry(QtCore.QRect(10, 380, 81, 31))
        self.label_10.setObjectName("label_10")
        self.label_11 = QtWidgets.QLabel(self.centralwidget)
        self.label_11.setGeometry(QtCore.QRect(10, 430, 111, 31))
        self.label_11.setObjectName("label_11")
        self.label_9 = QtWidgets.QLabel(self.centralwidget)
        self.label_9.setGeometry(QtCore.QRect(10, 480, 91, 31))
        self.label_9.setObjectName("label_9")
        self.label_12 = QtWidgets.QLabel(self.centralwidget)
        self.label_12.setGeometry(QtCore.QRect(10, 530, 91, 31))
        self.label_12.setObjectName("label_12")
        self.label_13 = QtWidgets.QLabel(self.centralwidget)
        self.label_13.setGeometry(QtCore.QRect(240, 390, 61, 31))
        self.label_13.setObjectName("label_13")
        self.label_14 = QtWidgets.QLabel(self.centralwidget)
        self.label_14.setGeometry(QtCore.QRect(240, 150, 71, 51))
        self.label_14.setObjectName("label_14")
        self.BTN1 = QtWidgets.QPushButton(self.centralwidget)
        self.BTN1.setGeometry(QtCore.QRect(450, 220, 91, 41))
        self.BTN1.setObjectName("BTN1")
        self.BTN2 = QtWidgets.QPushButton(self.centralwidget)
        self.BTN2.setGeometry(QtCore.QRect(450, 450, 91, 41))
        self.BTN2.setObjectName("BTN2")
        self.RES1 = QtWidgets.QTextBrowser(self.centralwidget)
        self.RES1.setGeometry(QtCore.QRect(310, 150, 221, 41))
        self.RES1.setObjectName("RES1")
        self.RES2 = QtWidgets.QTextBrowser(self.centralwidget)
        self.RES2.setGeometry(QtCore.QRect(310, 380, 221, 41))
        self.RES2.setObjectName("RES2")
        self.T1 = QtWidgets.QTextEdit(self.centralwidget)
        self.T1.setGeometry(QtCore.QRect(130, 130, 71, 31))
        self.T1.setObjectName("T1")
        self.M1 = QtWidgets.QTextEdit(self.centralwidget)
        self.M1.setGeometry(QtCore.QRect(130, 210, 71, 31))
        self.M1.setObjectName("M1")
        self.A1 = QtWidgets.QTextEdit(self.centralwidget)
        self.A1.setGeometry(QtCore.QRect(130, 250, 71, 31))
        self.A1.setObjectName("A1")
        self.E1 = QtWidgets.QTextEdit(self.centralwidget)
        self.E1.setGeometry(QtCore.QRect(130, 290, 71, 31))
        self.E1.setObjectName("E1")
        self.M2 = QtWidgets.QTextEdit(self.centralwidget)
        self.M2.setGeometry(QtCore.QRect(350, 210, 71, 31))
        self.M2.setObjectName("M2")
        self.A2 = QtWidgets.QTextEdit(self.centralwidget)
        self.A2.setGeometry(QtCore.QRect(350, 250, 71, 31))
        self.A2.setObjectName("A2")
        self.E2 = QtWidgets.QTextEdit(self.centralwidget)
        self.E2.setGeometry(QtCore.QRect(350, 290, 71, 31))
        self.E2.setObjectName("E2")
        self.T2 = QtWidgets.QTextEdit(self.centralwidget)
        self.T2.setGeometry(QtCore.QRect(130, 380, 71, 31))
        self.T2.setObjectName("T2")
        self.P2 = QtWidgets.QTextEdit(self.centralwidget)
        self.P2.setGeometry(QtCore.QRect(130, 430, 71, 31))
        self.P2.setObjectName("P2")
        self.NAME1 = QtWidgets.QTextEdit(self.centralwidget)
        self.NAME1.setGeometry(QtCore.QRect(130, 480, 71, 31))
        self.NAME1.setObjectName("NAME1")
        self.NAME2 = QtWidgets.QTextEdit(self.centralwidget)
        self.NAME2.setGeometry(QtCore.QRect(130, 530, 71, 31))
        self.NAME2.setObjectName("NAME2")
        self.P1 = QtWidgets.QTextEdit(self.centralwidget)
        self.P1.setGeometry(QtCore.QRect(130, 170, 71, 31))
        self.P1.setObjectName("P1")
        self.line = QtWidgets.QFrame(self.centralwidget)
        self.line.setGeometry(QtCore.QRect(0, 340, 801, 16))
        self.line.setFrameShape(QtWidgets.QFrame.HLine)
        self.line.setFrameShadow(QtWidgets.QFrame.Sunken)
        self.line.setObjectName("line")
        self.label_15 = QtWidgets.QLabel(self.centralwidget)
        self.label_15.setGeometry(QtCore.QRect(210, 40, 111, 31))
        self.label_15.setObjectName("label_15")
        self.label_16 = QtWidgets.QLabel(self.centralwidget)
        self.label_16.setGeometry(QtCore.QRect(220, 350, 91, 21))
        self.label_16.setObjectName("label_16")
        self.label_17 = QtWidgets.QLabel(self.centralwidget)
        self.label_17.setGeometry(QtCore.QRect(560, 160, 101, 21))
        self.label_17.setObjectName("label_17")
        self.label_18 = QtWidgets.QLabel(self.centralwidget)
        self.label_18.setGeometry(QtCore.QRect(560, 390, 101, 31))
        self.label_18.setObjectName("label_18")
        MainWindow.setCentralWidget(self.centralwidget)
        self.menubar = QtWidgets.QMenuBar(MainWindow)
        self.menubar.setGeometry(QtCore.QRect(0, 0, 801, 18))
        self.menubar.setObjectName("menubar")
        MainWindow.setMenuBar(self.menubar)
        self.statusbar = QtWidgets.QStatusBar(MainWindow)
        self.statusbar.setObjectName("statusbar")
        MainWindow.setStatusBar(self.statusbar)

        self.retranslateUi(MainWindow)
        self.BTN1.clicked.connect(self.RES1.show)
        self.BTN2.clicked.connect(self.RES2.show)
        QtCore.QMetaObject.connectSlotsByName(MainWindow)

    def retranslateUi(self, MainWindow):
        """
        给控件加名称
        """
        _translate = QtCore.QCoreApplication.translate
        MainWindow.setWindowTitle(_translate("MainWindow", "MainWindow"))
        self.label.setText(_translate("MainWindow", "温度T (K)"))
        self.label_2.setText(_translate("MainWindow", "压强P (bar)"))
        self.label_3.setText(_translate("MainWindow", "Ma (g/mol)"))
        self.label_4.setText(_translate("MainWindow", "δa (A)"))
        self.label_5.setText(_translate("MainWindow", "εa/k (K)"))
        self.label_6.setText(_translate("MainWindow", "Mb (g/mol)"))
        self.label_7.setText(_translate("MainWindow", "δb (A)"))
        self.label_8.setText(_translate("MainWindow", "εb/k (K)"))
        self.label_10.setText(_translate("MainWindow", "温度T (K)"))
        self.label_11.setText(_translate("MainWindow", "压强P (bar)"))
        self.label_9.setText(_translate("MainWindow", "元素a"))
        self.label_12.setText(_translate("MainWindow", "元素b"))
        self.label_13.setText(_translate("MainWindow", "Result"))
        self.label_14.setText(_translate("MainWindow", "Result"))
        self.BTN1.setText(_translate("MainWindow", "Calculate"))
        self.BTN2.setText(_translate("MainWindow", "Calculate"))
        self.label_15.setText(_translate("MainWindow", "手动计算"))
        self.label_16.setText(_translate("MainWindow", "自动计算"))
        self.label_17.setText(_translate("MainWindow", "D (cm*cm/s)"))
        self.label_18.setText(_translate("MainWindow", "D (cm*cm/s)"))

import sys
from PyQt5.QtWidgets import QApplication, QMainWindow
#from target import *
import PyQt5.sip
import pandas as pd
import math

df=pd.read_excel(".\扩散系数.xlsx")

def get_Info(name):
    """
    检索元素
    map函数的作用:
    eg.map(function1,list1) 作用就是对list1中每个元素执行function1函数，返回一个迭代器
    """
    return list(map(float,[df[df["种类"]==name]["A"],df[df["种类"]==name]["E"],df[df["种类"]==name]["M"]])) #将迭代器转化成列表返回

def OMG_D(k,T,Eij):
    #计算OMG_D
    x1=1.06036/(((k*T)/Eij)**0.1561)
    x2=0.193/math.exp((0.47635*k*T)/Eij)
    x3=1.03587/math.exp((1.52996*k*T)/Eij)
    x4=1.76474/math.exp((3.89411*k*T)/Eij)
    return x1+x2+x3+x4

def E_ij(E1,E2):
    #计算Eij
    Eij=(E1*E2)**0.5
    return Eij
    
def Dij(P,T,M1,M2,A1,A2,E1,E2):
    #P=P*(10**5)
    #A1=A1*(10**-8)
    #A2=A2*(10**-8)
    k=1
    #k=1.380649e-23
    Eij=E_ij(E1,E2)
    OMGd=OMG_D(k,T,Eij)
    
    w1=0.00266
    TT=T**1.5
    FenZi=w1*TT

    FenMu=(((2*M1*M2)/(M1+M2))**0.5)*(((A1+A2)/2)**2)*P*OMGd
    result=FenZi/FenMu
    print("OMGD=",OMGd)
    print("OMGD=",((2*M1*M2)/(M1+M2))**0.5)#排除
    print("OMGD=",((A1+A2)/2)**2)
    return result

class MyWindow(QMainWindow, Ui_MainWindow):
    def __init__(self, parent=None):
        super(MyWindow, self).__init__(parent)
        self.setupUi(self)
        self.setWindowTitle("二元扩散系数计算")
        self.BTN1.clicked.connect(self.BTN1_click)
        self.BTN2.clicked.connect(self.BTN2_click)

    def BTN1_click(self):
        #监听按钮地安集事件
        try:
            T1n=float(self.T1.toPlainText())#获取文本框数据，并转化为flost类型
            P1n=float(self.P1.toPlainText())
            M1n=float(self.M1.toPlainText())
            A1n=float(self.A1.toPlainText())
            E1n=float(self.E1.toPlainText())
            M2n=float(self.M2.toPlainText())
            A2n=float(self.A2.toPlainText())
            E2n=float(self.E2.toPlainText())
            result=Dij(P1n,T1n,M1n,M2n,A1n,A2n,E1n,E2n) #计算
            self.RES1.setPlainText(str(result)) #结果显示
        except:
            self.RES1.setPlainText("请检查输入")

    def BTN2_click(self):
        try:
            T2n=float(self.T2.toPlainText())
            P2n=float(self.P2.toPlainText())
            name1=self.NAME1.toPlainText()
            name2=self.NAME2.toPlainText()
            TEMP1=get_Info(name1)  #通过元素名字检索
            TEMP2=get_Info(name2)
            M1n=float(float(TEMP1[2]))
            A1n=float(float(TEMP1[0]))
            E1n=float(float(TEMP1[1]))
            M2n=float(float(TEMP2[2]))
            A2n=float(float(TEMP2[0]))
            E2n=float(float(TEMP2[1]))

            result=Dij(P2n,T2n,M1n,M2n,A1n,A2n,E1n,E2n)
            self.RES2.setPlainText(str(result))
        except:
            self.RES2.setPlainText("请检查输入")


    



if __name__ == '__main__':
    app = QApplication(sys.argv)
    myWin = MyWindow()
    myWin.show()
    sys.exit(app.exec_())
